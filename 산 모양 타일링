def solution(n, tops):
    MOD = 10007
    
    # a: i번째 단계에서 오른쪽으로 튀어나온 마름모가 없는 경우의 수
    # b: i번째 단계에서 오른쪽으로 튀어나온 마름모가 있는 경우의 수
    a, b = 1, 0
    
    for i in range(n):
        prev_a, prev_b = a, b
        
        if tops[i] == 1:
            # 위에 정삼각형이 붙어 있는 경우
            # 1. 튀어나오지 않게 마감하는 경우: 
            #    이전이 a일 때 3가지 선택지, 이전이 b일 때 2가지 선택지
            a = (prev_a * 3 + prev_b * 2) % MOD
            # 2. 다음 칸으로 마름모를 내보내는 경우:
            #    이전이 a일 때 1가지 선택지, 이전이 b일 때 1가지 선택지
            b = (prev_a + prev_b) % MOD
        else:
            # 위에 정삼각형이 없는 경우
            # 1. 튀어나오지 않게 마감하는 경우:
            #    이전이 a일 때 2가지 선택지, 이전이 b일 때 1가지 선택지
            a = (prev_a * 2 + prev_b) % MOD
            # 2. 다음 칸으로 마름모를 내보내는 경우:
            #    이전이 a일 때 1가지 선택지, 이전이 b일 때 1가지 선택지
            b = (prev_a + prev_b) % MOD
            
    # 최종 결과는 마지막 단계에서 마감된 경우와 튀어나온 경우를 모두 합친 값입니다.
    return (a + b) % MOD
